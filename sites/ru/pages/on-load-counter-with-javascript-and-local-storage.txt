=title Счетчик загрузок с помощью JavaScript и локального хранилища
=timestamp 2015-04-05T17:30:01
=indexes localStorage, getElementById
=status show
=books javascript
=author szabgab
=original on-load-counter-with-javascript-and-local-storage
=translator name2rnd
=archive 1
=comments_disqus_enable 

=abstract start

Являясь часть большого проекта <a href="https://code-maven.com/counter">Примеры счетчиков</a>, эта статья расскажет, как создать
простой счетчик загрузок на чистом JavaScript, использующим локальное хранилище (Local Storage) из HTML5.

=abstract end

В HTML5 <b>localStorage</b> это термин, используемый для обозначения простой "ключ-значение" базы данных в браузере (или, если более точно,
на жестком диске компьютера, планшета или смартфона, где работает браузер), к которой мы можем получить доступ из JavaScript.

Это очень простой пример, демонстрирующий счетчик, который увеличивается каждый раз, когда вы перезагружаете страницу.
Так как счетчик хранится в вашем собственном браузере и связан с конкретным сайтом, который вы посетили, то его значение не зависит от того,
что видят другие люди, или от того, что увидите вы, загрузив страницу с другого устройства или в другом браузере на этом же устройстве.

<try file="examples/js/counter_on_load.html">

Нажмите на <a href="/try/examples/js/counter_on_load.html" target="_new">Try!</a>, чтобы увидеть, как это работает (откроется в отдельном окне).

Пример содержит единственный HTML элемент <hl>div</hl>, который имеет уникальный ID <hl>counter</hl> и немного JavaScript.
Метод <hl>getItem</hl> из класса <hl>localStorage</hl> запросит текущее значение для полученного ключа (в этом случае 'on_load_counter') и
присвоит его к <hl>n</hl>.

В первый раз, когда мы загрузим эту страницу, мы не получим значение для ключа, а вместо этого <hl>getItem</hl> вернет <hl>null</hl>.

Затем, если мы получили действительно <hl>null</hl>, мы установим наш счетчик в 0.

Затем увеличиваем счетчик <hl>n++;</hl>.

Затем используем метод <hl>setItem</hl> класса <hl>localStorage</hl>, чтобы установить значение для ключа 'on_load_counter' в то, что сейчас в <hl>n</hl>

Заключительный шаг - показ нового значения на HTML странице. <hl>document.getElementById('counter')</hl> предоставляет доступ
к элементу с id <hl>counter</hl>, содержимое которого мы заменяем на значение в n.

<h2>Сброс счетчика</h2>

В следующем примере мы собираемся добавить кнопку сброса счетчика. Но для начала посмотрим кое-что другое.
Если вы нажмете на <a href="/try/examples/js/counter_on_load_reset.html" target="_new">Try!</a>, в новом окне откроется другой пример
(URL будет другой, но страница находится на том же самом сайте). Вы увидите счетчик на этой странице, начинающийся со значения, 
которое было на первой странице (в первом примере). На самом деле, если вы по очереди будете посещать эти две страницы, то увидите, 
что на самом деле, они ссылаются на один и тот же счетчик (на то же самое место в локальном хранилище).
 
<try file="examples/js/counter_on_load_reset.html">

В этом примере мы добавили другой HTML элемент - <hl>button</hl> с ID <hl>reset</hl>.
В коде JavaScript мы добавили функцию <hl>reset_counter</hl>, которая при вызове будет использовать метод <hl>removeItem</hl> класса 
<hl>localStorage</hl>, чтобы удалить пару ключ-значение из локального хранилища.

В последней строке мы снова вызываем <hl>document.getElementById('reset')</hl>, чтобы идентифицировать нашу кнопку, затем добавляем
обработчик события с помощью метода <hl>addEventListener</hl>. Это заставит JavaScript вызывать функцию <hl>reset_counter</hl> каждый раз, 
когда переданный элемент HTML (кнопка 'reset') будет нажат.

Если вы откроете пример, нажав по ссылке <b>Try!</b>, то увидите счетчик и кнопку. Когда вы нажмете на кнопку, то вам покажется, что ничего
не произошло. Это потому, что мы не обновили страницу после сброса счетчика. Единственная вещь, которая на самом деле произошла - мы удалили
пару ключ-значение из локального хранилища.

Если вам хочется поиграться с этим примером, тогда добавьте немного кода, который будет автоматически обновлять значение счетчика на 
новое после нажатия кнопки сброса.
