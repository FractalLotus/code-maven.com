=title Чтение файла с Node.js - блокирующее и неблокирующее
=timestamp 2015-02-07T10:03:01
=indexes fs, readFile, readFileSync
=status show
=books nodejs
=author szabgab
=original reading-a-file-with-nodejs
=translator name2rnd
=archive 1
=comments_disqus_enable 0

=abstract start

Если вы хотите сделать веб-сервер на Node.js или просто какое-то приложение, тогда вам нужно уметь читать файлы. 

Node предоставляет библиотеку <a href="http://nodejs.org/api/fs.html">fs</a> для работы с файловой системой. К примеру, для чтения файлов.

=abstract end

<h2>Асинхронное чтение файла (неблокирующее)</h2>

"Нормальный" способ чтения файлов в Node.js это чтение асинхронным способом. Это значит, что вы вызываете команду чтения файла и передаете callback, который будет вызван при завершении чтения. Это позволяет работать с несколькими запросами чтения параллельно.

Для этого мы можем использовать метод <a href="http://nodejs.org/api/fs.html#fs_fs_readfile_filename_options_callback">readFile</a> из класса <hl>fs</hl>.

<include file="examples/node/non-blocking-read-file.js">

Для начала мы загружаем класс <hl>fs</hl> с помощью команды <hl>require</hl>. Затем вызываем метод <hl>readFile</hl>, который получает 3 параметра: имя файла ('DATA' в нашем случае), кодировку файла ('utf8' в примере) и функцию. Эта функция будет вызывана, когда завершится операция чтения файла. Функция получит два параметра. Первый - информация о каких-либо ошибках, второй - содержимое файла.

Как только программа будет запущена, Node начнет читать файл в фоновом режиме, но продолжит выполнение. Таким образом, сначала будет выполнен вызов <hl>console.log('after calling readFile');</hl>, который выведет этот текст в консоль.
Затем, когда содержимое файла будет загружено в память, Node вызовет функцию, которую мы передали в метод <hl>readFile</hl>, и она выведет в консоль содержимое файла.

<h2>Синхронное чтение файла (блокирующее)</h2>

Люди, пришедшие из других языков программирования (из большинства), считают синхронное чтение файлов более очевидным. Я не знаю в какой ситуации вы захотите использовать синхронные операции в Node.js, но я вижу, что много асинхронных функций имеют синхронный вариант, наверное, этим кто-то пользуется.

Для чтения файлов вы можете использовать метод <a href="http://nodejs.org/api/fs.html#fs_fs_readfilesync_filename_options">readFileSync</a> из класса <hl>fs</hl>:

<include file="examples/node/blocking-read-file.js">
